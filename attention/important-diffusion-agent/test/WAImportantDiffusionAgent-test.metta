!(register-module! ../../../../metta-attention)
!(import! &self metta-attention:attention-bank:utilities:helper-functions)
!(import! &self metta-attention:attention-bank:attention-value:getter-and-setter)
!(import! &self metta-attention:attention-bank:bank:atom-bins:atombins)
!(import! &self metta-attention:attention-bank:bank:attention-bank)
!(import! &self metta-attention:attention-bank:bank:attentional-focus:attentional-focus)
!(import! &self metta-attention:attention-bank:bank:importance-index:importance-index)
!(import! &self metta-attention:attention:important-diffusion-agent:helper:removeHebbianLink)
!(import! &self metta-attention:attention:ImportanceDiffusionBase:importanceDiffusion)
!(import! &self metta-attention:attention:ImportanceDiffusionBase:diffusionAtom)
!(import! &self metta-attention:attention-bank:bank:atom-bins:get-min-max-content)
!(import! &self metta-attention:attention:AFImportantDiffusionAgent:AFImportanceDiffusionAgent)
!(import! &self metta-attention:attention:important-diffusion-agent:WAImportantDiffusionAgent)
!(import! &self metta-attention:attention:ImportanceDiffusionBase:updateSTI)

;mock data

;preparing the test dummy data
!(add-atom &atombin (1 (A)))
!(add-atom &atombin (2 (B)))
!(add-atom &atombin (3 (C)))
!(add-atom &atombin (4 (D)))
!(setAv A (0.0 0.0 0.0))
!(setAv B (7.0 4.0 0.0))
!(setAv c (0.0 0.0 0.0))
!(setAv D (100.0 200.0 300.0))
! (setStv A (400 400))
! (setStv B (400 400))
! (setStv C (400 400))
! (setStv D (400 400))
! (setAv A (10 20 1))
! (setAv B (30 40 1))
! (setAv C (50 50 1))
! (setAv D (400 400 1))
!(addAtomToAF D)
!(addAtomToAF B)
!(addAtomToAF C)
;add hebbian link between two atom
!(add-atom &attentionalFocus (habbianlink A B))
!(add-atom &attentionalFocus (habbianlink A C))
!(add-atom &attentionalFocus (habbianlink A D))
!(add-atom &attentionalFocus (habbianlink C B))
;add ASYMMETRIC_HEBBIAN_LINK for mock test
!(add-atom &atombin (5 (E)))
!(add-atom &atombin (6 (F)))
!(add-atom &atombin (7 (G)))
!(add-atom &atombin (8 (H)))
!(setAv E (0.0 0.0 0.0))
!(setAv F (7.0 4.0 0.0))
!(setAv G (0.0 0.0 0.0))
!(setAv H (100.0 200.0 300.0))
! (setStv E (4 5))
! (setStv F (1 2))
! (setStv G (3 3))
! (setStv H (1 0.7))
! (setAv E (10 20 1))
! (setAv F (30 40 1))
! (setAv G (50 50 1))
! (setAv H (400 400 1))

!(addAtomToAF E)
!(addAtomToAF F)
!(addAtomToAF G)
!(add-atom &attentionalFocus (ASYMMETRIC_HEBBIAN_LINK A F))
!(add-atom &attentionalFocus (ASYMMETRIC_HEBBIAN_LINK A G))
!(hebbianAdjacentAtoms A)

;add type hebbian link

!(add-atom &heabinLink (B HebbianLink))

!(add-atom &attentionalFocus (C))
!(add-atom &attentionalFocus (D))
!(add-atom &attentionalFocus (B))
!(add-atom &attentionalFocus (H))
!(add-atom &attentionalFocus (E))
!(add-atom &attentionalFocus (F))
!(add-atom &attentionalFocus (G))
!(get-atoms &diffusedAtomSpace)

;before spreadImportance among the atom
!(assertEqual (getSTI A) 10)
!(assertEqual (getSTI B) 30)
!(assertEqual (getSTI C) 50)
!(assertEqual (getSTI D) 400)
!(assertEqual (getSTI E) 10)
!(assertEqual (getSTI F) 30)
!(assertEqual (getSTI G) 50)
!(assertEqual (getSTI H) 400)
;call function to spread importance among the atom
!(spreadImportance)
;affter spreadImportance among the atom

!(let* (
    ($sitA (getSTI A)) ; some time there is  precision error it add 0.00000000000001 or 0.00000000000002 to the last
    )
    (if (and (>= $sitA 5.99999999999999) (<= $sitA 6.00000000001)) ; there is precision error in the test
        (assertEqual True True) 
        (assertEqual True False)

    )
)
!(assertEqual (getSTI B) 30)
!(assertEqual (getSTI C) 51.725)
!(assertEqual (getSTI D) 401.725)
!(assertEqual (getSTI E) 10)
!(assertEqual (getSTI F) 30.1)
!(assertEqual (getSTI G) 50.45)
!(assertEqual (getSTI H) 400)
